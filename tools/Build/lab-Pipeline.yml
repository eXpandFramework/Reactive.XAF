jobs:
- job: Test
  strategy:
    parallel: 15

  pool:
    vmImage: windows-2019
  steps:
    - task: DownloadBuildArtifacts@0
      inputs:
        buildType: 'specific'
        project: 'dc0010e5-9ecf-45ac-b89d-2d51897f3855'
        pipeline: '23'
        buildVersionToDownload: 'latestFromBranch'
        branchName: 'refs/heads/lab'
        downloadType: 'single'
        downloadPath: '$(System.DefaultWorkingDirectory)'
        artifactName: 'Xpand.XAF.Modules.Bin'
    - task: VSTest@2
      displayName: 'VsTest - testAssemblies'
      inputs:
        searchFolder: '$(System.DefaultWorkingDirectory)'
        testSelector: 'testAssemblies'
        uiTests: true
        testAssemblyVer2: |
          **\*Tests.dll
          !**\*Reactive.Logger.Hub.Tests*.dll
          !**\*TestAdapter.dll
          !**\obj\**
        
        diagnosticsEnabled: true
        runInParallel: true
        codeCoverageEnabled: true
        distributionBatchType: 'basedOnAssembly'
      
        collectDumpOn: never
    