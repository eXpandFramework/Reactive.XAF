# https://aka.ms/yaml
resources:
- repo: self
trigger:
- lab
queue:
  name: Hosted VS2017
  demands: 
  - msbuild
  - visualstudio
steps:
- powershell: |
   .\go.ps1 -msbuild "C:\Program Files (x86)\Microsoft Visual Studio\2017\Enterprise\MSBuild\15.0\Bin\msbuild.exe" -packageSources $(DXApiFeed)
  displayName: 'Build'
  failOnStderr: true
- task: VSTest@2
  displayName: 'VsTest - testAssemblies'
  inputs:
    testAssemblyVer2: |
     .\bin\DevExpress.XAF.Agnostic.Specifications.dll
    uiTests: true
- task: PublishPipelineArtifact@0
  displayName: 'Publish Pipeline Artifact'
  inputs:
    artifactName: package
    targetPath: bin/nuget
- task: PublishCodeCoverageResults@1
  displayName: 'Publish code coverage from ''$(System.DefaultWorkingDirectory)/**/*coverage.xml''
  inputs:
    codeCoverageTool: Cobertura
    summaryFileLocation: '''$(System.DefaultWorkingDirectory)/**/*coverage.xml''
    reportDirectory: '$(System.DefaultWorkingDirectory)/**/coverage'
    failIfCoverageEmpty: true
- task: NuGetCommand@2
  displayName: 'NuGet push'
  inputs:
    command: push
    publishVstsFeed: '1884bfa2-32ec-403a-ac30-771c5b8e4872'
    allowPackageConflicts: true



